sudo: required
addons:
  apt:
    packages:
    - docker-ce
env:
  global:
  - secure: "tsQWKFS0mgOPATacRm3HKFss+rrpvPonVGtEMnhT6KMwFWzuMBbOCWKGiNTX5ZnLGwifTZ+KhFSE0rLipi8TrVOBB4tRqbc6lvs/Q+8LkLT7ECvOL4+1YtoqLFqGGnTbnujD7yWy7a8GMAPjSxDXZhDLivKCYOS4w3H0N0BzIkKnalz5a0myfkJ3286wrze/JVnVyd3mUCNGV6u4RyUKwM4E6V+RGM+iSQGkwS6A3XtYD9cztdNvOfbWvuZPGZOCICO7Ibyvv4ptJQwxLhYS7ag1l//ICdntUKfCwT19URjiz5G5klYge2UX9FAaSFux7AgpKOEi8w8lDGoAdibpgzW6xRZjwE80uMuXjAhkgqulIvd37HO5ioLZOKfNEL1DIViEmAKUwQ4hRrhAzaDQUYbAck+YYeBPk/NW4bdv1J7E3C8j5KOldwgMpjGyynYCXchIV9+OxEMxrnOYAfD2gj/luTEWH+xMVrWHueG5xygDbJImbDNCSNKkplsyc3Pjr8aPrr2LS/nHkHDPRVR9SfYunAiaL7WGzqmYRw2kBWk3XWIPZ8KZVWvzVcRY7Jqd6Tz3BHFWLMsB4GK2Z5rQdDhmJQ+/YpPV938VHUb1HbmosFvHkKffBQgkrY8PrDQ+/XFotZJU/l82RsHlNw2z2DReBgNqMGP6oJ76paqqmvY="
  - secure: "to1agj3QyVsN4kfsAu22+xfPpZwj6yCHBTKt/nb1e5yO9/iI9jnE3qMeLD3zA9KvUxp3eVmFcLpKA9U8cWvlaIShYfly/k4sn7C26FhZvSbK0cCYIxH9h5N6OaHNJb/tjG+VJGnoKz8uKjS9VbcSR2L9fKxFxslBW15gqo6VIueN5EQmIxrc6WcHv9mz8OkJ6E/XSLL6hQYpQp34jmFM0+kpaQptKjnMKl7om/0TshL16Np4nzMRK+L0dkpocjeVD5V5IEjveXJPjmpyFwyjKovKLmMB32xBpK+Ox7t0rF0Fa7Uw+QE5a16sDRj614DNW0QJO2FsK/JBP5rtA44eVWaZ56EtDj1GaZUb7ntBBU4ROln7lBPBroGGtEaSizM2Z3mBAHZmuLa9WZVS1tSPGmQdzBb9LyBHmjFlqTN1y9OC6eXB0xWDfzO2/M9NQgVGOY3wAHr0fkW/jgLoEezoy2AXAetyBCdTMjFivlaalZsctkEDoYBrNEujuQtQzOZ1EoG5rlXJQDief8yxxyAZP1nRpcDttGKEpUgaRhZGwU7FPnmiT/67Y0++obJ8hLnbAsWMFSltx2VpOL4V2oVdFzFJwMGErkuDJ1BWhBU9DtQgNfOhJFruPHfeApA1ZM9T5JKbh34ePp7tHP2hFlJ0fWzxHCwmKAkSZg41+PmVExc="
stages:
- docker-creation
- multiarch-release
jobs:
  include:
  - stage: docker-creation
    script:
    - set -e
    - source ./.travis/travis_utils.sh
    - prepare_everything
    - deploy_docker './docker/amd64-Dockerfile' $KOLIBRI_AMD64 $KOLIBRI_AMD64_LATEST
  - stage: docker-creation
    script:
    - set -e
    - source ./.travis/travis_utils.sh
    - prepare_everything
    - deploy_docker './docker/aarch64-Dockerfile' $KOLIBRI_AARCH64 $KOLIBRI_AARCH64_LATEST
  - stage: docker-creation
    script:
    - set -e
    - source ./.travis/travis_utils.sh
    - prepare_everything
    - deploy_docker './docker/arm-Dockerfile' $KOLIBRI_ARM $KOLIBRI_ARM_LATEST
  - stage: multiarch-release
    script:
    - set -e
    - source ./.travis/travis_utils.sh
    - prepare_everything
    - create_multiarch_manifest_planet $KOLIBRI_ARM_LATEST $KOLIBRI_AMD64_LATEST $KOLIBRI_AARCH64_LATEST
    - push_multiarch_manifests

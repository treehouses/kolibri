sudo: required
addons:
  apt:
    packages:
    - docker-ce
env:
  global:
  - secure: UOkwSpg10Le1sQbu+3V1JPxvGoukoiw8RTY/RDERgIDThiSQjjUl/wBq1JKYqyEqza2qAN59FoTPa7r8Z78GjXlB3aURmQ4UbtCi2qM166a1XT0ew/C8wZ1Vi0JaK3jLnx/h2GsIAbRWV2HGqzHEY9naxT+dTluDF1pM3mRcovBQrzmqr2Wx44fty92/5DqUF/3JRRwD3lyDyp8a6MspQgbUPK7z47Gm2d3D09uvurx9YH5RoyqqlQM30kyJ2UrjUnGPdd2iiYTpc/ADvABX+09r/DeXkOYkni8iih47p4uBJyEDM7pNMjBjHSw3YWCW1zZJzg/oWHyntZYD5dsdwVfSAFIt+NgATUEwNGud25/o3w1MerXMj5e/2lOL+MwBgXXFKvW2uVcg+g7QRQkqfirGOggavwynwFS7dlkBET/DI52/RoUDBsac5Ts5O1Z0Ki+pScSUeIjP9nIiY/09JeNYbEci3lyzwhAbQv/BYtKShZQETGYK8C289qk+zT5hMT5SdZmEcje5Olyd0LNcxamMohJBmhLCIXQ85UfatOO1zf7kT6ZC/L4m/GaOZcbbxlNyZR6949620q2tLUPqZHE0Jvl6FP/fbjuYFkooV80cUv8WYhcQg/knIt5A8zcr8v7bEGjTfa7FpXd6Lk/dXc4bijZcTzHaR4PVPJpgiOs=
  - secure: Fopt19ztX1005f23RrCYUbv2fu2Oo+JLAYjnirDWvaR/69wTBNS11YAWiZs/wB6bv9igj5IS22gU2qmcvOXtRnNnZAa/xvOPX+DPW6pUs+/9A5XRDwSdyyTJpTAeF33CaBQZT3RollgZZro70FhG9fUo5BDyRbTwqXk/ozrFW7N9z/6uEJWftfjmK2puMFdfOwTTcQYE6kZu40ZVVXaYXfGngT6b/tIjK+c7XFBGxKSOSq4z3a+ZAv/E38+3DJcKX5WQmvHK9ChqHmSp4mzP3Cv61CE+aukauemAs7af2KxBMv56wLsMG4xsjB/p7mDRMdk5DfjFGPDpL5e18m438th3iTqTFn4TdCX4S7mI8rl7VQxg88Y3kHZ/S3gn5rOleFwSboFOMiVR1jnTYYm1qSE+dA47omL3Z0jiWTfNScDyUwEsjvVejPsaLjkDFukPRp00I05d9UMvwdKQBz4UOfkiz7426vktMk7Q+ZKdXbzWZzFEZeQ2rs+ELCPgZGJbxh2T1yQPSCbD3nXEsh1O83Y+HHfwKEAOQDrd8DE1BMK5ZT4S9E3RZFek/cWmFVdcG+jNbvoQdhhklqwRmj4x8S1Sq2AiIODWGu3Z2K4B5aUIAVC3BKfl0KDnrpAqgCihXnjO8uOouPt5fSPgLptABB/TrcmOyHLDOznaYBdypu4=
before_script: docker login --username=$DOCKER_USER --password=$DOCKER_PASS
stages:
- docker-creation
- multiarch-release
jobs:
  include:
  - stage: docker-creation
    script:
    - set -e
    - source ./.travis/travis_utils.sh
    - prepare_everything
    - deploy_docker './docker/amd64-Dockerfile' $KOLIBRI_AMD64 $KOLIBRI_AMD64_LATEST
  - stage: docker-creation
    script:
    - set -e
    - source ./.travis/travis_utils.sh
    - prepare_everything
    - deploy_docker './docker/aarch64-Dockerfile' $KOLIBRI_AARCH64 $KOLIBRI_AARCH64_LATEST
  - stage: docker-creation
    script:
    - set -e
    - source ./.travis/travis_utils.sh
    - prepare_everything
    - deploy_docker './docker/arm-Dockerfile' $KOLIBRI_ARM $KOLIBRI_ARM_LATEST
  - stage: multiarch-release
    script:
    - set -e
    - source ./.travis/travis_utils.sh
    - prepare_everything
    - create_multiarch_manifest_planet $KOLIBRI_ARM_LATEST $KOLIBRI_AMD64_LATEST $KOLIBRI_AARCH64_LATEST
    - push_multiarch_manifests

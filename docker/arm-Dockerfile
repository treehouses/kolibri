FROM multiarch/alpine:armhf-latest-stable

#install python
RUN apk update && apk add \
    python \
    curl

#no need to add cleaning command as alpine cleans package automatically

ENV TAG_NAME $(curl --silent "https://api.github.com/repos/learningequality/kolibri/releases/latest" | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/')

#download kolibri
RUN curl -o kolibri -L https://github.com/learningequality/kolibri/releases/download/TAG_NAME/*.pex

#make executable
RUN chmod +x kolibri

#used for storing db and content (used when mounting volume)
RUN mkdir /root/.kolibri

EXPOSE 8080

CMD ./kolibri start && tail -f /root/.kolibri/server.log
